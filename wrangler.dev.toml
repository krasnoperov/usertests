# ============================================================================
# UserTests - Local Development Configuration
# ============================================================================

account_id = "2d61278ad8b69df60cde602758926e14"
name = "usertests-local"
main = "src/worker/unified.ts"
compatibility_date = "2025-04-01"
compatibility_flags = ["nodejs_compat"]

[observability]
enabled = true

[assets]
directory = "./dist/frontend"
not_found_handling = "single-page-application"
run_worker_first = ["/api/*", "/.well-known/*"]

# D1 Database - LOCAL
[[d1_databases]]
binding = "DB"
database_name = "usertests-local"
database_id = "00000000-0000-0000-0000-000000000000"
migrations_dir = "db/migrations"

# KV namespace for OAuth state
[[kv_namespaces]]
binding = "OAUTH_KV"
id = "08f7fd3b25ac4cc59ad9e2975d510df3"

[vars]
NODE_ENV = "development"
ENVIRONMENT = "local"

[dev]
port = 8788
local_protocol = "http"

# Local dev: unified worker handles queue too
# [[queues.consumers]]
# queue = "usertests-processing-local"
# max_batch_size = 1
# max_batch_timeout = 60
# max_retries = 3
#
# [[queues.producers]]
# queue = "usertests-processing-local"
# binding = "PROCESSING_QUEUE"

# [[r2_buckets]]
# binding = "STORAGE"
# bucket_name = "usertests-storage-local"
